"use strict";var XBBCODE=(function(){var q={},e=/^(?:https?|file|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:@#%&()~_?\+=\/\\\.]*$/,d=/^(?:red|green|blue|orange|yellow|black|white|brown|gray|silver|purple|maroon|fushsia|lime|olive|navy|teal|aqua)$/,b=/^#?[a-fA-F0-9]{6}$/,f,r,j=[],o,c,k,l,a;f={b:{openTag:function(u,t){return'<span class="xbbcode-b">'},closeTag:function(u,t){return"</span>"}},bbcode:{openTag:function(u,t){return""},closeTag:function(u,t){return""}},code:{openTag:function(u,t){return'<span class="xbbcode-code">'},closeTag:function(u,t){return"</span>"},noParse:true},color:{openTag:function(v,u){var t=v.substr(1)||"black";d.lastIndex=0;b.lastIndex=0;if(!d.test(t)){if(!b.test(t)){t="black"}else{if(t.substr(0,1)!=="#"){t="#"+t}}}return'<span style="color:'+t+'">'},closeTag:function(u,t){return"</span>"}},i:{openTag:function(u,t){return'<span class="xbbcode-i">'},closeTag:function(u,t){return"</span>"}},img:{openTag:function(v,u){var t=u;e.lastIndex=0;if(!e.test(t)){t=""}return'<img src="'+t+'" />'},closeTag:function(u,t){return""},displayContent:false},list:{openTag:function(u,t){return"<ul>"},closeTag:function(u,t){return"</ul>"},restrictChildrenTo:["*","li"]},noparse:{openTag:function(u,t){return""},closeTag:function(u,t){return""},noParse:true},php:{openTag:function(u,t){return'<span class="xbbcode-code">'},closeTag:function(u,t){return"</span>"},noParse:true},quote:{openTag:function(u,t){return'<blockquote class="xbbcode-blockquote">'},closeTag:function(u,t){return"</blockquote>"}},s:{openTag:function(u,t){return'<span class="xbbcode-s">'},closeTag:function(u,t){return"</span>"}},size:{openTag:function(v,u){var t=parseInt(v.substr(1),10)||0;if(t<4||t>40){t=14}return'<span class="xbbcode-size-'+t+'">'},closeTag:function(u,t){return"</span>"}},table:{openTag:function(u,t){return'<table class="xbbcode-table">'},closeTag:function(u,t){return"</table>"},restrictChildrenTo:["tbody","thead","tfoot","tr"]},tbody:{openTag:function(u,t){return"<tbody>"},closeTag:function(u,t){return"</tbody>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},tfoot:{openTag:function(u,t){return"<tfoot>"},closeTag:function(u,t){return"</tfoot>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},thead:{openTag:function(u,t){return'<thead class="xbbcode-thead">'},closeTag:function(u,t){return"</thead>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},td:{openTag:function(u,t){return'<td class="xbbcode-td">'},closeTag:function(u,t){return"</td>"},restrictParentsTo:["tr"]},th:{openTag:function(u,t){return'<td class="xbbcode-th">'},closeTag:function(u,t){return"</td>"},restrictParentsTo:["tr"]},tr:{openTag:function(u,t){return'<tr class="xbbcode-tr">'},closeTag:function(u,t){return"</tr>"},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},u:{openTag:function(u,t){return'<span class="xbbcode-u">'},closeTag:function(u,t){return"</span>"}},url:{openTag:function(v,u){var t;if(!v){t=u.replace(/<.*?>/g,"")}else{t=v.substr(1)}e.lastIndex=0;if(!e.test(t)){t="#"}return'<a href="'+t+'">'},closeTag:function(u,t){return"</a>"}},"*":{openTag:function(u,t){return"<li>"},closeTag:function(u,t){return"</li>"},restrictParentsTo:["list"]}};r=[];(function(){var v,u,t;for(v in f){if(f.hasOwnProperty(v)){if(v==="*"){r.push("\\"+v)}else{r.push(v);if(f[v].noParse){j.push(v)}}f[v].validChildLookup={};f[v].validParentLookup={};f[v].restrictParentsTo=f[v].restrictParentsTo||[];f[v].restrictChildrenTo=f[v].restrictChildrenTo||[];t=f[v].restrictChildrenTo.length;for(u=0;u<t;u++){f[v].validChildLookup[f[v].restrictChildrenTo[u]]=true}t=f[v].restrictParentsTo.length;for(u=0;u<t;u++){f[v].validParentLookup[f[v].restrictParentsTo[u]]=true}}}})();o=new RegExp("<bbcl=([0-9]+) ("+r.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi");c=new RegExp("\\[("+r.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi");k=new RegExp("\\[("+j.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi");(function(){var u=[];for(var t=0;t<r.length;t++){if(r[t]!=="\\*"){u.push("/"+r[t])}}l=new RegExp("(\\[)((?:"+r.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi");a=new RegExp("(\\[)("+u.join("|")+")(\\])","gi")})();function m(G,B,A,w,u,v,H){H=H||[];A++;var x=new RegExp("(<bbcl="+A+" )("+r.join("|")+")([ =>])","gi"),z=new RegExp("(<bbcl="+A+" )("+r.join("|")+")([ =>])","i"),F=v.match(x)||[],E,t,D,y,C=f[G]||{};x.lastIndex=0;if(!F){v=""}for(D=0;D<F.length;D++){z.lastIndex=0;y=(F[D].match(z))[2].toLowerCase();if(C.restrictChildrenTo.length>0){if(!C.validChildLookup[y]){t='The tag "'+y+'" is not allowed as a child of the tag "'+G+'".';H.push(t)}}E=f[y]||{};if(E.restrictParentsTo.length>0){if(!E.validParentLookup[G]){t='The tag "'+G+'" is not allowed as a parent of the tag "'+y+'".';H.push(t)}}}v=v.replace(o,function(I,J,K,L,M){H=m(K,I,J,K,L,M,H);return I});return H}function s(t){t=t.replace(/\<([^\>][^\>]*?)\>/gi,function(u,w){var v=w.match(/^bbcl=([0-9]+) /);if(v===null){return"<bbcl=0 "+w+">"}else{return"<"+w.replace(/^(bbcl=)([0-9]+)/,function(x,z,y){return z+(parseInt(y,10)+1)})+">"}});return t}function n(t){return t.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;")}var p=function(t,u,y,z,A){y=y.toLowerCase();var x=f[y].noParse?n(A):A.replace(o,p),w=f[y].openTag(z,x),v=f[y].closeTag(z,x);if(f[y].displayContent===false){x=""}return w+x+v};function h(u){var t=u.text;t=t.replace(o,p);return t}function i(t){t=t.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/ig,"<");t=t.replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/ig,">");while(t!==(t=t.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(u,x,v){var w=u;while(w!==(w=w.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(y,B,A){if(A===">/list]"){A="</*]</list]"}else{A="</*][*]"}var z="<*]"+B+A;return z}))){}w=w.replace(/>/g,"<");return w}))){}t=t.replace(/</g,"[");return t}function g(t){while(t!==(t=t.replace(c,function(u,v,w,x){u=u.replace(/\[/g,"<");u=u.replace(/\]/g,">");return s(u)}))){}return t}q.process=function(v){var u={html:"",error:false},t=[];v.text=v.text.replace(/</g,"&lt;");v.text=v.text.replace(/>/g,"&gt;");v.text=v.text.replace(l,function(w,x,z,y){return"<"+z+">"});v.text=v.text.replace(a,function(w,x,z,y){return"<"+z+">"});v.text=v.text.replace(/\[/g,"&#91;");v.text=v.text.replace(/\]/g,"&#93;");v.text=v.text.replace(/</g,"[");v.text=v.text.replace(/>/g,"]");while(v.text!==(v.text=v.text.replace(k,function(w,x,y,z){z=z.replace(/\[/g,"&#91;");z=z.replace(/\]/g,"&#93;");y=y||"";z=z||"";return"["+x+y+"]"+z+"[/"+x+"]"}))){}v.text=i(v.text);v.text=g(v.text);t=m("bbcode",v.text,-1,"","",v.text);u.html=h(v);if(u.html.indexOf("[")!==-1||u.html.indexOf("]")!==-1){t.push("Some tags appear to be misaligned.")}if(v.removeMisalignedTags){u.html=u.html.replace(/\[.*?\]/g,"")}if(v.addInLineBreaks){u.html=u.html.replace(/\r\n/g,"\n");u.html=u.html.replace(/(\r|\n)/g,"$1<br/>")}u.html=u.html.replace("&#91;","[");u.html=u.html.replace("&#93;","]");u.error=(t.length===0)?false:true;u.errorQueue=t;return u};return q})();