"use strict";var XBBCODE=function(b){var r={},f=/^(?:https?|file|c):(?:\/{1,3}|\\{1})[-a-zA-Z0-9:@#%&()~_?\+=\/\\\.]*$/,e=/^(?:red|green|blue|orange|yellow|black|white|brown|gray|silver|purple|maroon|fushsia|lime|olive|navy|teal|aqua)$/,c=/^#?[a-fA-F0-9]{6}$/,g,s,k=[],p,d,l,m,a;g={b:{openTag:function(v,u){return'<span class="xbbcode-b">'},closeTag:function(v,u){return"</span>"}},bbcode:{openTag:function(v,u){return""},closeTag:function(v,u){return""}},code:{openTag:function(v,u){return'<span class="xbbcode-code">'},closeTag:function(v,u){return"</span>"},noParse:true},color:{openTag:function(w,v){var u=w.substr(1)||"black";e.lastIndex=0;c.lastIndex=0;if(!e.test(u)){if(!c.test(u)){u="black"}else{if(u.substr(0,1)!=="#"){u="#"+u}}}return'<span style="color:'+u+'">'},closeTag:function(v,u){return"</span>"}},i:{openTag:function(v,u){return'<span class="xbbcode-i">'},closeTag:function(v,u){return"</span>"}},img:{openTag:function(w,v){var u=v;f.lastIndex=0;if(!f.test(u)){u=""}return'<img src="'+u+'" />'},closeTag:function(v,u){return""},displayContent:false},list:{openTag:function(v,u){return"<ul>"},closeTag:function(v,u){return"</ul>"},restrictChildrenTo:["*","li"]},noparse:{openTag:function(v,u){return""},closeTag:function(v,u){return""},noParse:true},php:{openTag:function(v,u){return'<span class="xbbcode-code">'},closeTag:function(v,u){return"</span>"},noParse:true},quote:{openTag:function(v,u){return'<blockquote class="xbbcode-blockquote">'},closeTag:function(v,u){return"</blockquote>"}},s:{openTag:function(v,u){return'<span class="xbbcode-s">'},closeTag:function(v,u){return"</span>"}},size:{openTag:function(w,v){var u=parseInt(w.substr(1),10)||0;if(u<4||u>40){u=14}return'<span class="xbbcode-size-'+u+'">'},closeTag:function(v,u){return"</span>"}},table:{openTag:function(v,u){return'<table class="xbbcode-table">'},closeTag:function(v,u){return"</table>"},restrictChildrenTo:["tbody","thead","tfoot","tr"]},tbody:{openTag:function(v,u){return"<tbody>"},closeTag:function(v,u){return"</tbody>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},tfoot:{openTag:function(v,u){return"<tfoot>"},closeTag:function(v,u){return"</tfoot>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},thead:{openTag:function(v,u){return'<thead class="xbbcode-thead">'},closeTag:function(v,u){return"</thead>"},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},td:{openTag:function(v,u){return'<td class="xbbcode-td">'},closeTag:function(v,u){return"</td>"},restrictParentsTo:["tr"]},th:{openTag:function(v,u){return'<th class="xbbcode-th">'},closeTag:function(v,u){return"</th>"},restrictParentsTo:["tr"]},tr:{openTag:function(v,u){return'<tr class="xbbcode-tr">'},closeTag:function(v,u){return"</tr>"},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},u:{openTag:function(v,u){return'<span class="xbbcode-u">'},closeTag:function(v,u){return"</span>"}},url:{openTag:function(w,v){var u;if(!w){u=v.replace(/<.*?>/g,"")}else{u=w.substr(1)}f.lastIndex=0;if(!f.test(u)){u="#"}return'<a href="'+u+'">'},closeTag:function(v,u){return"</a>"}},"*":{openTag:function(v,u){return"<li>"},closeTag:function(v,u){return"</li>"},restrictParentsTo:["list"]}};(function(){var u;if(b){for(u in b){g[u]=b[u]}}}());s=[];(function(){var w,v,u;for(w in g){if(g.hasOwnProperty(w)){if(w==="*"){s.push("\\"+w)}else{s.push(w);if(g[w].noParse){k.push(w)}}g[w].validChildLookup={};g[w].validParentLookup={};g[w].restrictParentsTo=g[w].restrictParentsTo||[];g[w].restrictChildrenTo=g[w].restrictChildrenTo||[];u=g[w].restrictChildrenTo.length;for(v=0;v<u;v++){g[w].validChildLookup[g[w].restrictChildrenTo[v]]=true}u=g[w].restrictParentsTo.length;for(v=0;v<u;v++){g[w].validParentLookup[g[w].restrictParentsTo[v]]=true}}}})();p=new RegExp("<bbcl=([0-9]+) ("+s.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi");d=new RegExp("\\[("+s.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi");l=new RegExp("\\[("+k.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi");(function(){var v=[];for(var u=0;u<s.length;u++){if(s[u]!=="\\*"){v.push("/"+s[u])}}m=new RegExp("(\\[)((?:"+s.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi");a=new RegExp("(\\[)("+v.join("|")+")(\\])","gi")})();function n(H,C,B,x,v,w,I){I=I||[];B++;var y=new RegExp("(<bbcl="+B+" )("+s.join("|")+")([ =>])","gi"),A=new RegExp("(<bbcl="+B+" )("+s.join("|")+")([ =>])","i"),G=w.match(y)||[],F,u,E,z,D=g[H]||{};y.lastIndex=0;if(!G){w=""}for(E=0;E<G.length;E++){A.lastIndex=0;z=(G[E].match(A))[2].toLowerCase();if(D.restrictChildrenTo.length>0){if(!D.validChildLookup[z]){u='The tag "'+z+'" is not allowed as a child of the tag "'+H+'".';I.push(u)}}F=g[z]||{};if(F.restrictParentsTo.length>0){if(!F.validParentLookup[H]){u='The tag "'+H+'" is not allowed as a parent of the tag "'+z+'".';I.push(u)}}}w=w.replace(p,function(J,K,L,M,N){I=n(L,J,K,L,M,N,I);return J});return I}function t(u){u=u.replace(/\<([^\>][^\>]*?)\>/gi,function(v,x){var w=x.match(/^bbcl=([0-9]+) /);if(w===null){return"<bbcl=0 "+x+">"}else{return"<"+x.replace(/^(bbcl=)([0-9]+)/,function(y,A,z){return A+(parseInt(z,10)+1)})+">"}});return u}function o(u){return u.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;")}var q=function(u,v,z,A,B){z=z.toLowerCase();var y=g[z].noParse?o(B):B.replace(p,q),x=g[z].openTag(A,y),w=g[z].closeTag(A,y);if(g[z].displayContent===false){y=""}return x+y+w};function i(v){var u=v.text;u=u.replace(p,q);return u}function j(u){u=u.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/ig,"<");u=u.replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/ig,">");while(u!==(u=u.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(v,y,w){var x=v;while(x!==(x=x.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(z,C,B){if(B===">/list]"){B="</*]</list]"}else{B="</*][*]"}var A="<*]"+C+B;return A}))){}x=x.replace(/>/g,"<");return x}))){}u=u.replace(/</g,"[");return u}function h(u){while(u!==(u=u.replace(d,function(v,w,x,y){v=v.replace(/\[/g,"<");v=v.replace(/\]/g,">");return t(v)}))){}return u}r.process=function(w){var v={html:"",error:false},u=[];w.text=w.text.replace(/</g,"&lt;");w.text=w.text.replace(/>/g,"&gt;");w.text=w.text.replace(m,function(x,y,A,z){return"<"+A+">"});w.text=w.text.replace(a,function(x,y,A,z){return"<"+A+">"});w.text=w.text.replace(/\[/g,"&#91;");w.text=w.text.replace(/\]/g,"&#93;");w.text=w.text.replace(/</g,"[");w.text=w.text.replace(/>/g,"]");while(w.text!==(w.text=w.text.replace(l,function(x,y,z,A){A=A.replace(/\[/g,"&#91;");A=A.replace(/\]/g,"&#93;");z=z||"";A=A||"";return"["+y+z+"]"+A+"[/"+y+"]"}))){}w.text=j(w.text);w.text=h(w.text);u=n("bbcode",w.text,-1,"","",w.text);v.html=i(w);if(v.html.indexOf("[")!==-1||v.html.indexOf("]")!==-1){u.push("Some tags appear to be misaligned.")}if(w.removeMisalignedTags){v.html=v.html.replace(/\[.*?\]/g,"")}if(w.addInLineBreaks){v.html=v.html.replace(/\r?\n/g,"<br>")}v.html=v.html.replace("&#91;","[");v.html=v.html.replace("&#93;","]");v.error=(u.length===0)?false:true;v.errorQueue=u;return v};return r};